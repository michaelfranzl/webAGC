<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>webAGC Demo</title>
    <meta name="viewport" content="width=500">
    <link rel="stylesheet" href="screen.css">

    <script type="importmap">
      {
        "imports": {
          "WebAGC": "../src/webAGC.js",
          "@wasmer/wasi": "./jspm_packages/npm/@wasmer/wasi@0.12.0/lib/index.esm.js",
          "@wasmer/wasi/": "./jspm_packages/npm/@wasmer/wasi@0.12.0/",
          "@wasmer/wasmfs": "./jspm_packages/npm/@wasmer/wasmfs@0.12.0/lib/index.esm.js",
          "buffer": "./jspm_packages/npm/@jspm/core@1.1.1/nodelibs/buffer.js",
          "crypto": "./jspm_packages/npm/@jspm/core@1.1.1/nodelibs/crypto.js",
          "fs": "./jspm_packages/npm/@jspm/core@1.1.1/nodelibs/@empty.js",
          "path": "./jspm_packages/npm/@jspm/core@1.1.1/nodelibs/path.js",
          "process": "./jspm_packages/npm/@jspm/core@1.1.1/nodelibs/process.js",
          "tty": "./jspm_packages/npm/@jspm/core@1.1.1/nodelibs/tty.js",
          "webdsky": "./jspm_packages/npm/webdsky@1.1.0/webDSKY.js",
          "path-browserify/": "./jspm_packages/npm/path-browserify@1.0.1/",
          "randomfill/index.dew.js": "./jspm_packages/npm/randomfill@1.0.4/browser.dew.js",
          "safe-buffer/": "./jspm_packages/npm/safe-buffer@5.2.1/",
          "randombytes/index.dew.js": "./jspm_packages/npm/randombytes@2.1.0/browser.dew.js"
        }
      }
    </script>
    <script type="module" src="index.js"></script>
  </head>

  <body>
    <h1>webAGC Demo</h1>

    <p>
      This demo is part of
      <a href="https://github.com/michaelfranzl/webAGC" target="_blank">webAGC</a>,
      a port of yaAGC (an emulator of the Apollo Guidance Computer from the
      <a href="https://www.ibiblio.org/apollo/" target="_blank">Virtual AGC Project</a>)
      to the web platform.
    </p>

    <p>
      <i>To ease the deployment workflow of this demo, it currently requires a browser supporting
        <a href="https://caniuse.com/?search=importmap" target="_blank">import maps</a>
        (e.g. based on Chromium 89 or newer).</i>
    </p>

    <hr/>

    <h3>AGC emulator (yaAGC)</h3>

    <p>This is a WebAssembly build of yaAGC commit ID <a id='yaAGC_version'></a></p>

    <div>
      <label>Clock divisor:</label>
      <select id="clock_divisor">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="4">4</option>
        <option value="8">8</option>
        <option value="16">16</option>
        <option value="32">32</option>
        <option value="64">64</option>
        <option value="128">128</option>
        <option value="256">256</option>
        <option value="512">512</option>
        <option value="1024">1024</option>
        <option value="2048">2048</option>
        <option value="4096">4096</option>
        <option value="8192">8192</option>
        <option value="32768">32768</option>
        <option value="65536">65536</option>
        <option value="inf">inf</option>
      </select>
    </div>

    <div>
      <label>Instructions per second:</label>
      <span id="clock_speed"></span>
    </div>
    <div>
      <label>CPU manipulation:</label>
      <button id="button_reset">Reset</button>
      <button id="button_pause">Pause</button>
      <button id="button_step">Step</button>
      <button id="button_run">Run</button>
    </div>
    <div>
      <label>State:</label>
      <span id="agc_state"></span>
    </div>

    <hr/>

    <h3>AGC software</h3>

    <p>
      For demonstration purposes, you can choose below from only two programs,
      <code>Luminary099.bin</code> and <code>Validation.bin</code>.
    </p>

    <p>
      <b>Validation.bin:</b> This is a "modern" AGC program originally written by Ronald Burkey to
      test the AGC emulator. When the "OPR ERR" lamp is blinking, press the <kbd>PRO</kbd> key.
      After 38 seconds, the number 77 should be displayed in the PROG field. This means that the
      test suite was successful.
    </p>

    <p>
      <b>Luminary099.bin:</b> This is the AGC program used in the Apollo 11 Lunar Module. Aside from
      being able to land on the Moon, it also can do simple things which are useful for testing.
      For example:
      <ul>
        <li>Type <kbd>VERB</kbd> <kbd>3</kbd> <kbd>5</kbd> <kbd>ENTR</kbd>: Lamp test.</li>
        <li>Type <kbd>VERB</kbd> <kbd>1</kbd> <kbd>6</kbd> <kbd>NOUN</kbd> <kbd>6</kbd> <kbd>5</kbd>
          <kbd>ENTR</kbd>: Show seconds, minutes and hours since the program has started
          ('uptime').
        </li>
      </ul>
    </p>

    <p>
      For more information on these programs, please see
      <a href="https://www.ibiblio.org/apollo/" target="_blank">the Virtual AGC website</a>.
    </p>

    <p>
      <label>Load program into fixed memory:</label>
      <select name="" id="programs">
        <option></option>
        <option value="Luminary099.bin">Luminary099.bin</option>
        <option value="Validation.bin">Validation.bin</option>
      </select>
    </p>

    <hr/>

    <h3>DiSplay and KeYboard (DSKY) of the AGC</h3>
    <p>Interact with the DSKY by clicking on its keys, or by typing letters into the input field.
    (The input field may not work on Chromium for Android because of Chromium bug 118639.)</p>
    <div>
      <label>DSKY key input:</label>
      <input id="dsky_key_input"></input>
      <br/>
      <small>
        <kbd>0</kbd>-<kbd>9</kbd>, <kbd>+</kbd>, <kbd>-</kbd>, VERB: <kbd>v</kbd>, NOUN: <kbd>n</kbd>,CLR: <kbd>c</kbd>, KEY REL: <kbd>k</kbd>, ENTR: <kbd>e</kbd> or <kbd>Enter</kbd>, RSET: <kbd>r</kbd>, PRO: <kbd>p</kbd>
      </small>
    </div>

    <div id="dsky"></div>

    <hr/>

    <h2>Erasable memory</h2>
    <p>This is a live view on 8 banks of 256 15-bit words in octal notation. CPU registers are
    located in the erasable memory and are labeled.</p>
    <agc-erasable-memory></agc-erasable-memory>
  </body>
</html>
